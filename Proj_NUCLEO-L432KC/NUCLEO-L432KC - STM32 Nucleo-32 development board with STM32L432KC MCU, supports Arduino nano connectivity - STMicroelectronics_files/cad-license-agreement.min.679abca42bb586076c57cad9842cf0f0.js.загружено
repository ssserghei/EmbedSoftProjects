window.initCadLicenseAgreement=function(){function H(){$(document).on("click",".js-cad-license-agreement",function(a){a.preventDefault();a=$(this);l=a.data("file-name");m=a.data("file-version");p=a.data("reg-path");x=a.data("path");n=a.data("download-path-encrypted");y(e)&&null===b("light_approvals")?z.modal("toggle"):g.modal("toggle")});$(".accept-license").click(function(a){I(a)});$("#loginRegister").click(function(){h.modal("hide");"undefined"!==typeof p&&""!==p&&(c("dl",n,7884E8),c("cadResourceName_"+
e,l,7884E8),c("cadResourceVersion_"+e,m,7884E8),window.location.href=p)});$(".start-over-btn").click(function(){c("emailCadSent_"+e,"",0);c("email","",0);c("firstName","",0);c("familyName","",0);c("st_cad_download_license_agreement","",0);c("cadResourceName_"+e,"",0);c("cadResourceVersion_"+e,"",0);c("dl","",0);c("light_approvals","",0);k.modal("hide");z.modal("hide");h.modal("hide");A.modal("hide");window.location.href=window.location.href.split("?")[0]});J.submit(function(a){a.preventDefault();
if(!K($(this)))return!1;L($(this))})}function M(){if("reload"!==String(window.performance.getEntriesByType("navigation")[0].type)&&"back_forward"!==String(window.performance.getEntriesByType("navigation")[0].type)){var a=(new window.URLSearchParams(window.location.search)).get("dl");null!==a&&null===b("dl")&&c("dl",a,7884E8);var d={};null!==a?y(e)&&q(a,null,d)?c("light_approvals","light_registration_approved",7884E8):k.modal("toggle"):-1!==window.location.href.indexOf(".product\x3d"+e+".")&&-1!==
window.location.href.indexOf(".license\x3d")&&null!==b("dl")&&null!==b("cadResourceName_"+e)&&null!==b("cadResourceVersion_"+e)&&($("div[data-nav-tab-id\x3dcad-resources]").click(),a=b("dl"),null!==a&&q(null,a,d)?(c("dl","",0),c("cadResourceName_"+e,"",0),c("cadResourceVersion_"+e,"",0)):k.modal("toggle"))}}function N(){B.each(function(){$(this).find(".st-tooltip--content").text(C)});B.click(function(a){a.preventDefault()})}function L(a){var d=a.serializeArray();d.push({name:"keepInformed",value:!0},
{name:"id",value:r},{name:"locale",value:D},{name:"path",value:x},{name:"downloadPathEncrypted",value:n});var t={};$.ajax({type:"POST",url:"/bin/st/dl-cad-resource-email",async:!1,data:d}).success(function(d){if(d&&!0===d.success){h.modal("hide");A.modal("toggle");c("email",a.find("#userEmail").val(),7884E8);c("firstName",a.find("#givenName").val(),7884E8);c("familyName",a.find("#familyName").val(),7884E8);c("cadResourceName_"+e,l,864E5);c("cadResourceVersion_"+e,m,864E5);c("emailCadSent_"+e,"emailCadHasBeenSent_"+
e,864E5);t.source="form";t.cadResourceName=l;t.cadResourceVersion=m;d=b("email");var E=b("firstName"),g=b("familyName");if(null!==d&&null!==E&&null!==g){var f=t||{};f.userEmail=d;f.userGivenName=E;f.userFamilyName=g;w(f)}}else h.modal("hide"),k.modal("toggle")}).fail(function(){h.modal("hide");k.modal("toggle")})}function I(a){a.preventDefault();$.ajax({url:"/bin/st/save-license-agreements",async:!0,type:"POST",dataType:"json",data:{resourceType:"CAD",path:g.data("section-path"),version:g.data("license-version"),
versionDate:g.data("license-date"),productId:r}}).complete(function(){g.modal("hide");if("undefined"!==typeof O)q(null,n,null)||k.modal("toggle");else if(null===b("email")||null===b("firstName")||null===b("familyName")||null===b("dl")||null===b("light_approvals"))h.modal("toggle");else{var a=b("dl");q(a,n,null)||k.modal("toggle")}})}function K(a){var d=!0;a.find("input[required]").each(function(a,c){d&&"undefined"!==typeof $(c).attr("data-invalid")&&(d=!1)});return d}function y(a){var d=b("emailCadSent_"+
a);return null!==d&&-1<d.indexOf("emailCadHasBeenSent_"+a)}function q(a,d,c){var b={prmisId:r,locale:D};null!==a&&"undefined"!==typeof a&&""!==a&&(b.dl=a);null!==d&&"undefined"!==typeof d&&""!==d&&(b.downloadPathEncrypted=d);if(3>Object.keys(b).length)return!1;a=c||{};a.source=a.source||"link";return P(b,a)}function P(a,d){var b=!1;$.ajax({type:"POST",url:"/bin/st/dl-cad-resource",async:!1,data:a}).success(function(a){if(a&&"undefined"!==typeof a.path){if(w(d)){var c=a.path;digitalData.sofdlemref=
c;u.init.downloadPath=c;u.start.downloadPath=c;$(window).trigger(u.init);$(window).trigger(u.start);window.location.href=a.path;b=!0}}else d.source="failedDownload",w(d)});return b}function w(a){if("undefined"===typeof v||!v){var d=STUtils.getBrowserInfo(),c=!1;$.ajax({url:"/bin/st/track-download-cad-resource",async:!1,type:"POST",data:{userEmail:a.userEmail||b("email")||f.data("user-email")||"",firstName:a.userGivenName||b("firstName")||f.data("user-first-name")||"",lastName:a.userFamilyName||b("familyName")||
f.data("user-last-name")||"",prmisId:r,cadResourceName:a.cadResourceName||l||b("cadResourceName_"+e)||"",cadResourceVersion:a.cadResourceVersion||m||b("cadResourceVersion_"+e)||"",touFlag:!0,licenseReference:a.licenseReference||g.data("license-id")||"",source:a.source||"",ipAddress:F,ipGeolocatedCountry:G,browserName:d.name,browserVersion:d.version},success:function(){c=!0}});return c}}function c(a,d,c){var b={path:"/"};b.expires=new Date(Date.now()+c);b.domain=window.location.host;b.expires&&b.expires.toUTCString&&
(b.expires=b.expires.toUTCString());a=a+"\x3d"+d;for(var e in b)a+="; "+e,d=b[e],!0!==d&&(a+="\x3d"+d);document.cookie=a}function b(a){return(a=document.cookie.match("(^|;) ?"+a+"\x3d([^;]*)(;|$)"))?a[2]:null}var B=$(".js-cad-license-agreement"),f=$("#cadLicenseAgreementContainer"),g=$("#cadLicenseAgreementModal"),h=$("#lightRegistrationModal"),J=h.find(".light-registration-form"),A=$("#registrationSuccessModal"),k=$("#failModal"),z=$("#emailNotValidModal"),O=f.data("user-logged-in"),r=f.data("product-id"),
e=f.data("product-name"),D=document.documentElement.lang.toLowerCase(),l,m,p,x,n,F,v,C,G,u={init:$.Event("download.init"),start:$.Event("download.start")};(function(){$.ajax({url:"/bin/st/geolocation/ip/restrictions",type:"POST",async:!1,success:function(a){null!==a&&""!==a&&(a=JSON.parse(a),F=a.clientIP,v=a.ifCountryRestricted,C=a.notAvailableForDownloadText,G=a.country)}})})();!v&&(window.isEuropeGdpr?null!==b("OptanonAlertBoxClosed"):1)?(M(),H()):N()};